<html>
<head>
    <meta charset="UTF-8">
    <title>Printer Helper</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
</head>
<body style="background: white;">
<div class="mx-auto pt-5" style="width: 400px;">
    <table class="table" id="saved_list">
        <colgroup>
          <col width="80%">
          <col width="*%">
        </colgroup>
        <tbody>
            <tr>
                <td>저장된 데이터가 없습니다</td><td><button class="btn btn-primary btn-sm btn-block disabled">확인</button></td>
            </tr>
        </tbody>
        <footer>
            <tr>
                <td></td><td><button id="closeBtn" class="btn btn-primary btn-sm btn-block">닫기</button></td>
            </tr>
        </footer>
    </table>
    <div id="debug">
    </div>
</div>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script>window.$ = window.jQuery = require('jquery');</script>
<!-- <script type="text/javascript" src="./util/jquery-3.5.1.min.js"></script> -->
<script type="text/javascript" src="./db.js"></script>
<script type="text/javascript">
    db = new DB()
    console.log("Test")
    $(document).ready(function() {
        var saved_list = db.get_title_list()
        if(saved_list != null) {
            $('#saved_list tr:first').remove();
        }

        saved_list.forEach(element => {
            var row_info = "<tr>";
            row_info += "<td>"+element+"</td>";
            row_info += '<td><button id="load_btn" class="btn btn-primary btn-sm btn-block">확인</button></td>';
            row_info += "</tr>"
            $('#saved_list').append(row_info);
        })
    });

    $(document).on("click", "#saved_list", function(e) {
        var title = e.target.parentElement.previousElementSibling.innerHTML
        try_close(title)
    })

    function try_close(info) {
        try {
            opener.popup_close(info)
        }catch(error) {
            $("#debug").html(error)
        }
    }

</script>
</body>
</html>